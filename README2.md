## JWT ##

https://hyeonddobbi.tistory.com/409

JWT 3가지 부분 구성
- Header : Signature를 해싱하기 위한 알고리즘 정보
- Payload : 서버와 클라이언트가 주고받는, 시스템에서 실제로 사용될 정보에 대한 내용을 담고 있음
  - 클레임 : 실제 담고 싶은 데이터 - Json 형식으로 저장
    - 표준 클레임
      - sub
      - iss
      - exp
      - etc...
    - 비공개 클레임
      - 회사/ 서비스 내부에서만 사용 하는 키(ex :  role, userid, permissions)
- Signature : token에 유효성 검증을 위한 문자열(유효한 토큰인지 검사)
  - Header + Payload를 비밀키(혹은 공개키 기반)로 서명한 값.

JWT 장점
- 중앙의 인증서버, 데이터 스토어에 대한 의존성 없음, 시스템 수평 확장 유리함.
- base64 URL Safe Encoding  > URL, Cookie, Header 모두 사용 가능(JWT는 범용성을 가지고 있음)

🚩중앙의 인증서버? 데이터 스토어?
- 세션 기반 인증에서는 사용자가 로그인하면 서버(혹은 Redis 같은 세션 저장소)애 세션 정보를 저장하고, 이후 요청마다 세션ID를 확인해야 한다.
- 즉, 항상 중앙 저장소를 조회해야한다는 뜻이다.
- jwt 기반 인증은 다르다. 토큰 자체에 사용자 정보(클래임)와 만료 시간, 서명이 포함되어 있어서 서버 저장소를 조회하지 않고도 토큰의 유효성을 검증할 수 있다.
- 곧 상태(state)를 서버가 기억할 필요가 없다.(stateless)
- 따라서 서버를 여러 대 두더라도 모두 같은 방식으로 토큰을 검증할 수 있으며, 중앙 세션 스토어에 대한 병목 현상이 사라진다.

🚩효과
- 인증 서버 부하 감소
- DB나 Redis같은 외부 스토리지 의존도 줄어듦
- 마이크로서비스 아키텍처에서 각 서비스가 독립적으로 토큰만 검증 가능

🚩 수평 확장에 유리
- 상태를 유지하지 않으니 로드밸런싱이 자유롭다.
- 세션 기반에서는 항상 같은 서버로 가야하는 구조이지만, jwt는 어디로 요청이 가든 동일하게 검증가능
- EC2나 쿠버네스트같은 환경에서 서비스 인스턴스 수십개를 띄워도, 별도 공유 메모리 없이 확장이 가능하다(클라우드 네이티브 환경에서 최적)

🚩Base64 URL-Safe Encoding → 범용성
- JWT는 Base64URL 인코딩을 사용합니다. 일반 Base64와 다르게 +, /, = 같은 URL에서 문제가 될 수 있는 문자가 제외

암호화/알고리즘 관련 용어
- HS256 (HMAC-SHA256) : 대칭키(서버만 알고 있는 비밀키) 기반 서명.
- RS256 (RSA-SHA256) : 비대칭키(공개키-비밀키) 기반 서명.
- ES256 (ECDSA-SHA256) : ECC 기반 서명 (더 짧고 빠름).

JWT 단점
- Payload의 정보가 많아지면 네트워크 사용량 증가, 데이터 설계 고려 필요함
- 토큰이 클라이언트에 저장, 서버에서 클라이언트의 토큰을 조작할 수 없음